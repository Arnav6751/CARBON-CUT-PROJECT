<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbon Cut - Your Dashboard</title>
    <!-- Chosen Palette: Eco-Modern (Emerald Green, Sky Blue, Clean White, Soft Gray) -->
    <!-- Application Structure Plan: A single-page dashboard layout is used to provide a centralized, immediate overview of the user's environmental impact and rewards. Navigation links scroll to dedicated sections, creating a seamless, task-oriented flow without page reloads. This structure was chosen for its ability to present real-time, interconnected data (impact, challenges, rewards) in an intuitive and engaging manner, directly aligning with the app's goal of making climate action easy and accessible. -->
    <!-- Visualization & Content Choices: Key metrics are presented as bold stat cards (Goal: Inform) for quick insights. Energy usage trends are shown with an interactive Chart.js line chart (Goal: Change), while appliance breakdown uses a doughnut chart (Goal: Compare). Challenges are displayed as progress bars (Goal: Engage), and rewards are in a grid (Goal: Inform). This mix of visualizations, all rendered on Canvas via Chart.js, provides a comprehensive and interactive user experience without relying on static or non-standard libraries like SVG or Mermaid. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 320px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .nav-link {
            transition: color 0.3s;
        }
        .nav-link.active {
            color: #10b981;
            font-weight: 600;
        }
        .stat-card {
            background-color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.3s;
            display: inline-block;
        }
        .btn-primary {
            background-color: #10b981;
            color: white;
        }
        .btn-primary:hover {
            background-color: #059669;
            transform: scale(1.05);
        }
        .btn-secondary {
            background-color: #3b82f6;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #2563eb;
            transform: scale(1.05);
        }
        .section-title {
            font-size: 2.25rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .section-subtitle {
            font-size: 1.125rem;
            color: #6b7280;
            max-width: 60ch;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 3rem;
        }
        /* Loading spinner styles for Gemini API */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: #ffffff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* FAQ accordion styles */
        .faq-question {
            background-color: #f3f4f6;
            padding: 1.25rem 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .faq-question:hover {
            background-color: #e5e7eb;
        }
        .faq-answer {
            background-color: #ffffff;
            padding: 1rem 1.5rem;
            border-top: 1px solid #e5e7eb;
            border-radius: 0 0 0.75rem 0.75rem;
            display: none; /* Hidden by default */
            transition: all 0.3s ease-in-out;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
        }
        .faq-answer.show {
            display: block;
            opacity: 1;
            max-height: 500px; /* Adjust as needed for content height */
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="text-gray-800">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <span class="w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center text-white font-bold text-xl">C</span>
                <span class="font-bold text-2xl text-gray-800">Carbon Cut</span>
            </div>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#dashboard" class="nav-link text-gray-600 hover:text-emerald-500">Dashboard</a>
                <a href="#impact" class="nav-link text-gray-600 hover:text-emerald-500">Impact</a>
                <a href="#recommendations" class="nav-link text-gray-600 hover:text-emerald-500">Recommendations</a>
                <a href="#challenges" class="nav-link text-gray-600 hover:text-emerald-500">Challenges</a>
                <a href="#rewards" class="nav-link text-gray-600 hover:text-emerald-500">Rewards</a>
                <a href="#devices" class="nav-link text-gray-600 hover:text-emerald-500">Devices</a>
                <a href="#faq" class="nav-link text-gray-600 hover:text-emerald-500">FAQ</a>
            </div>
            <div class="flex items-center space-x-4">
                <span class="text-2xl cursor-pointer">üîî</span>
                <img src="https://placehold.co/40x40/E2E8F0/4A5568?text=A" alt="User Profile" class="w-10 h-10 rounded-full cursor-pointer">
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">

        <section id="dashboard" class="text-center pt-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">Welcome Back, Arnav!</h1>
            <p class="mt-4 text-lg text-gray-600">Here's a summary of your positive impact this month.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-12 text-left">
                <div class="stat-card">
                    <div class="flex items-center space-x-4">
                        <span class="text-4xl">üåø</span>
                        <div>
                            <p class="text-gray-500">Total Carbon Cut</p>
                            <p class="text-3xl font-bold text-emerald-600">550 kg</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="flex items-center space-x-4">
                        <span class="text-4xl">‚ö°Ô∏è</span>
                        <div>
                            <p class="text-gray-500">Energy Saved</p>
                            <p class="text-3xl font-bold text-blue-600">85 kWh</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="flex items-center space-x-4">
                        <span class="text-4xl">üéÅ</span>
                        <div>
                            <p class="text-gray-500">Rewards Earned</p>
                            <p class="text-3xl font-bold text-amber-600">‚Çπ1,200</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card bg-emerald-50 border-emerald-200 border">
                    <div class="flex items-center space-x-4">
                        <span class="text-4xl">üèÜ</span>
                        <div>
                            <p class="text-gray-600">Active Challenge</p>
                            <p class="text-xl font-bold text-emerald-800">20% AC Reduction</p>
                            <p class="text-sm text-gray-500">7 days left</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="impact" class="text-center pt-24">
            <h2 class="section-title">Your Real-Time Impact</h2>
            <p class="section-subtitle">Visualize your energy consumption and carbon footprint. Interact with the charts to see your progress over different periods and understand where your biggest savings come from.</p>
            <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
                <div class="flex justify-center mb-6 space-x-2">
                    <button id="filter-day" class="px-4 py-2 text-sm font-semibold bg-emerald-100 text-emerald-800 rounded-full">Day</button>
                    <button id="filter-week" class="px-4 py-2 text-sm font-semibold bg-gray-100 text-gray-800 rounded-full">Week</button>
                    <button id="filter-month" class="px-4 py-2 text-sm font-semibold bg-gray-100 text-gray-800 rounded-full">Month</button>
                </div>
                <div class="chart-container">
                    <canvas id="energyUsageChart"></canvas>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-12 items-center">
                    <div class="text-left">
                        <h3 class="text-2xl font-bold mb-4">Appliance Breakdown</h3>
                        <p class="text-gray-600">This chart shows which of your appliances are consuming the most energy. Identifying the biggest users is the first step towards targeted savings and winning challenges.</p>
                    </div>
                    <div class="h-64 sm:h-80">
                            <canvas id="applianceBreakdownChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Personalized Recommendations Section -->
        <section id="recommendations" class="text-center pt-24">
            <h2 class="section-title">Personalized Recommendations</h2>
            <p class="section-subtitle">Based on your activity and goals, here are some tailored suggestions to further enhance your carbon cutting journey.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
                <div class="bg-white p-6 rounded-xl shadow-md text-left">
                    <div class="flex items-center mb-3">
                        <span class="text-3xl mr-3">üí°</span>
                        <h3 class="text-xl font-bold">Smart Lighting Upgrade</h3>
                    </div>
                    <p class="text-gray-600 mb-4">You're doing great with AC, but lighting accounts for 15% of your usage. Consider switching to LED smart bulbs for additional savings and remote control.</p>
                    <a href="#" class="text-emerald-600 hover:underline font-semibold">Learn More & Shop</a>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md text-left">
                    <div class="flex items-center mb-3">
                        <span class="text-3xl mr-3">üö¥</span>
                        <h3 class="text-xl font-bold">Explore EV Charging Challenge</h3>
                    </div>
                    <p class="text-gray-600 mb-4">Your car's usage is consistent. Join our 'Off-Peak Charging' challenge to optimize your EV charging schedule and earn bonus points!</p>
                    <a href="#" class="text-emerald-600 hover:underline font-semibold">Join Challenge</a>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md text-left">
                    <div class="flex items-center mb-3">
                        <span class="text-3xl mr-3">‚≠ê</span>
                        <h3 class="text-xl font-bold">Refer a Friend & Earn</h3>
                    </div>
                    <p class="text-gray-600 mb-4">Your dedication is inspiring! Refer a friend to Carbon Cut, and when they join a challenge, both of you will earn 500 bonus reward points.</p>
                    <a href="#" class="text-emerald-600 hover:underline font-semibold">Refer Now</a>
                </div>
            </div>
        </section>

        <section id="challenges" class="text-center pt-24">
            <h2 class="section-title">Challenges & Gamification</h2>
            <p class="section-subtitle">Join challenges to reduce your consumption in specific areas. Compete with yourself or the community, earn bonus rewards, and make saving fun.</p>
            <div class="space-y-6 max-w-4xl mx-auto">
                <div class="bg-white p-6 rounded-xl shadow-md flex flex-col md:flex-row items-center justify-between gap-4">
                    <div class="flex items-center gap-4 text-left">
                        <span class="text-4xl">‚ùÑÔ∏è</span>
                        <div>
                            <h3 class="text-xl font-bold">AC Reduction Challenge</h3>
                            <p class="text-gray-500">Goal: Reduce AC usage by 20% this week.</p>
                        </div>
                    </div>
                    <div class="w-full md:w-1/3">
                        <p class="text-sm text-right mb-1">60% Complete</p>
                        <div class="w-full bg-gray-200 rounded-full h-4">
                            <div class="bg-blue-500 h-4 rounded-full" style="width: 60%"></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md flex flex-col md:flex-row items-center justify-between gap-4">
                    <div class="flex items-center gap-4 text-left">
                        <span class="text-4xl">üí°</span>
                        <div>
                            <h3 class="text-xl font-bold">Phantom Load Hunt</h3>
                            <p class="text-gray-500">Goal: Turn off 5 standby devices each night.</p>
                        </div>
                    </div>
                    <div class="w-full md:w-1/3">
                        <p class="text-sm text-right mb-1">85% Complete</p>
                        <div class="w-full bg-gray-200 rounded-full h-4">
                            <div class="bg-emerald-500 h-4 rounded-full" style="width: 85%"></div>
                        </div>
                    </div>
                </div>
                <div class="pt-6">
                    <a href="#" class="btn btn-primary">Join a New Challenge</a>
                </div>
            </div>
        </section>

        <section id="rewards" class="text-center pt-24">
            <h2 class="section-title">Your Rewards Wallet</h2>
            <p class="section-subtitle">Your sustainable actions have earned you real-world benefits. Browse your available rewards and redeem them instantly, or explore exclusive offers from our partners.</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="bg-white rounded-xl shadow-lg overflow-hidden flex flex-col">
                    <img src="https://placehold.co/600x400/34D399/FFFFFF?text=OTT+Subscription" alt="Reward" class="w-full h-40 object-cover">
                    <div class="p-6 flex-grow flex flex-col">
                        <h3 class="text-xl font-bold">Free OTT Subscription</h3>
                        <p class="text-gray-600 mt-2 flex-grow">1 Month Premium Plan</p>
                        <a href="#" class="btn btn-secondary mt-4">Redeem Now</a>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg overflow-hidden flex flex-col">
                    <img src="https://placehold.co/600x400/F59E0B/FFFFFF?text=eCommerce+Coupon" alt="Reward" class="w-full h-40 object-cover">
                    <div class="p-6 flex-grow flex flex-col">
                        <h3 class="text-xl font-bold">eCommerce Coupon</h3>
                        <p class="text-gray-600 mt-2 flex-grow">‚Çπ500 Off Your Next Purchase</p>
                        <a href="#" class="btn btn-secondary mt-4">Redeem Now</a>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg overflow-hidden flex flex-col">
                    <img src="https://placehold.co/600x400/6366F1/FFFFFF?text=Coffee+Voucher" alt="Reward" class="w-full h-40 object-cover">
                    <div class="p-6 flex-grow flex flex-col">
                        <h3 class="text-xl font-bold">Coffee Voucher</h3>
                        <p class="text-gray-600 mt-2 flex-grow">Get a free coffee from our partner cafe.</p>
                        <a href="#" class="btn btn-secondary mt-4">Redeem Now</a>
                    </div>
                </div>
            </div>
        </section>

        <section id="devices" class="text-center pt-24">
            <h2 class="section-title">Manage Your Devices</h2>
            <p class="section-subtitle">View the status of your connected devices. Remotely control them to ensure you're not wasting energy when they're not in use.</p>
            <div class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-lg space-y-4">
                <div class="flex justify-between items-center p-4 border-b">
                    <div class="text-left">
                        <p class="font-bold text-lg">Living Room AC</p>
                        <p class="text-sm text-green-600 font-semibold">Online</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" value="" class="sr-only peer" checked>
                      <div class="w-14 h-7 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-600"></div>
                    </label>
                </div>
                   <div class="flex justify-between items-center p-4 border-b">
                    <div class="text-left">
                        <p class="font-bold text-lg">Kitchen Fridge</p>
                        <p class="text-sm text-green-600 font-semibold">Online</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" value="" class="sr-only peer" checked>
                      <div class="w-14 h-7 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-600"></div>
                    </label>
                </div>
                   <div class="flex justify-between items-center p-4">
                    <div class="text-left">
                        <p class="font-bold text-lg">Car OBD Tracker</p>
                        <p class="text-sm text-red-500 font-semibold">Offline</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" value="" class="sr-only peer">
                      <div class="w-14 h-7 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-600"></div>
                    </label>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section id="faq" class="text-center pt-24">
            <h2 class="section-title">Frequently Asked Questions</h2>
            <p class="section-subtitle">Find quick answers to common questions about Carbon Cut, how it works, and how you can maximize your impact and rewards.</p>
            <div class="max-w-4xl mx-auto space-y-4">
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="faq-question flex justify-between items-center" onclick="toggleAnswer(this)">
                        <h3 class="text-lg font-semibold text-gray-800">How does Carbon Cut accurately track my energy usage?</h3>
                        <span class="text-xl transform transition-transform duration-300 rotate-0">+</span>
                    </div>
                    <div class="faq-answer">
                        <p class="text-gray-700">Carbon Cut uses smart IoT plugs and optional OBD devices that connect directly to your appliances and vehicles. These devices automatically collect real-time energy consumption and usage data, sending it securely to our app. This hardware-verified approach ensures accuracy and prevents manual logging errors or fraudulent claims.</p>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="faq-question flex justify-between items-center" onclick="toggleAnswer(this)">
                        <h3 class="text-lg font-semibold text-gray-800">What kind of rewards can I earn, and how are they redeemed?</h3>
                        <span class="text-xl transform transition-transform duration-300 rotate-0">+</span>
                    </div>
                    <div class="faq-answer">
                        <p class="text-gray-700">You can earn a variety of tangible rewards, including free OTT subscriptions, Amazon coupons, exclusive discounts, and more from our partners. Once you meet a challenge target, your earned rewards appear in your "Rewards Wallet" on the dashboard, where you can instantly redeem them via unique codes or links.</p>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="faq-question flex justify-between items-center" onclick="toggleAnswer(this)">
                        <h3 class="text-lg font-semibold text-gray-800">Is my data secure and private with Carbon Cut?</h3>
                        <span class="text-xl transform transition-transform duration-300 rotate-0">+</span>
                    </div>
                    <div class="faq-answer">
                        <p class="text-gray-700">Yes, absolutely. We prioritize your data security and privacy. All usage data collected from your smart devices is encrypted and transmitted securely to our cloud platform. We adhere to strict data protection protocols and do not share your personalized consumption data with third parties without your explicit consent.</p>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="faq-question flex justify-between items-center" onclick="toggleAnswer(this)">
                        <h3 class="text-lg font-semibold text-gray-800">How do the challenges work, and can I participate in multiple?</h3>
                        <span class="text-xl transform transition-transform duration-300 rotate-0">+</span>
                    </div>
                    <div class="faq-answer">
                        <p class="text-gray-700">Challenges are designed to help you reduce consumption in specific areas (e.g., "AC Reduction Challenge"). You set a target, and our system tracks your progress based on real device data. While you can typically only have one active challenge per category, you can participate in different types of challenges simultaneously, maximizing your impact and rewards.</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-white mt-24">
        <div class="container mx-auto px-6 py-8 text-center">
            <p>&copy; 2025 Carbon Cut. All Rights Reserved.</p>
            <div class="mt-4 space-x-6">
                <a href="#" class="hover:underline">Privacy Policy</a>
                <a href="#" class="hover:underline">Terms of Service</a>
                <a href="#" class="hover:underline">Contact Us</a>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chartData = {
                day: {
                    labels: ['12am', '3am', '6am', '9am', '12pm', '3pm', '6pm', '9pm'],
                    data: [0.2, 0.1, 0.5, 1.2, 1.5, 2.5, 3.0, 0.8]
                },
                week: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    data: [15, 18, 16, 20, 22, 25, 21]
                },
                month: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    data: [120, 135, 110, 125]
                }
            };

            const applianceData = {
                labels: ['Air Conditioner', 'Refrigerator', 'Lighting', 'Vehicle Charging', 'Other'],
                data: [45, 25, 15, 10, 5]
            };

            const energyUsageCtx = document.getElementById('energyUsageChart').getContext('2d');
            const energyUsageChart = new Chart(energyUsageCtx, {
                type: 'line',
                data: {
                    labels: chartData.day.labels,
                    datasets: [{
                        label: 'Energy Usage (kWh)',
                        data: chartData.day.data,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#10b981',
                        pointBorderColor: '#fff',
                        pointHoverRadius: 7,
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#10b981'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#e5e7eb' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            const applianceBreakdownCtx = document.getElementById('applianceBreakdownChart').getContext('2d');
            const applianceBreakdownChart = new Chart(applianceBreakdownCtx, {
                type: 'doughnut',
                data: {
                    labels: applianceData.labels,
                    datasets: [{
                        label: 'Appliance Usage',
                        data: applianceData.data,
                        backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#8b5cf6', '#6b7280'],
                        borderColor: '#fff',
                        borderWidth: 4,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                padding: 20,
                            }
                        }
                    }
                }
            });

            const filterButtons = {
                day: document.getElementById('filter-day'),
                week: document.getElementById('filter-week'),
                month: document.getElementById('filter-month'),
            };

            function updateChart(period) {
                energyUsageChart.data.labels = chartData[period].labels;
                energyUsageChart.data.datasets[0].data = chartData[period].data;
                energyUsageChart.update();

                Object.values(filterButtons).forEach(btn => {
                    btn.classList.remove('bg-emerald-100', 'text-emerald-800');
                    btn.classList.add('bg-gray-100', 'text-gray-800');
                });
                filterButtons[period].classList.add('bg-emerald-100', 'text-emerald-800');
                filterButtons[period].classList.remove('bg-gray-100', 'text-gray-800');
            }

            filterButtons.day.addEventListener('click', () => updateChart('day'));
            filterButtons.week.addEventListener('click', () => updateChart('week'));
            filterButtons.month.addEventListener('click', () => updateChart('month'));

            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('main section');

            // Set initial active state for nav links
            const currentHash = window.location.hash || '#dashboard';
            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentHash) {
                    link.classList.add('active');
                }
            });

            window.addEventListener('scroll', () => {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    // Adjust offset for sticky header
                    const sectionHeight = section.clientHeight;
                    if (pageYOffset >= sectionTop - 100 && pageYOffset < sectionTop + sectionHeight - 100) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href').includes(current)) {
                        link.classList.add('active');
                    }
                });
            });

            // --- FAQ Accordion Logic ---
            const faqQuestions = document.querySelectorAll('.faq-question');
            faqQuestions.forEach(question => {
                question.addEventListener('click', () => {
                    const answer = question.nextElementSibling;
                    const plusIcon = question.querySelector('span'); // Assuming the + is the direct child span

                    // Close all other open answers
                    faqQuestions.forEach(otherQuestion => {
                        if (otherQuestion !== question) {
                            const otherAnswer = otherQuestion.nextElementSibling;
                            const otherPlusIcon = otherQuestion.querySelector('span');
                            if (otherAnswer.classList.contains('show')) {
                                otherAnswer.classList.remove('show');
                                otherPlusIcon.style.transform = 'rotate(0deg)';
                            }
                        }
                    });

                    // Toggle the clicked answer
                    if (answer.classList.contains('show')) {
                        answer.classList.remove('show');
                        plusIcon.style.transform = 'rotate(0deg)';
                    } else {
                        answer.classList.add('show');
                        plusIcon.style.transform = 'rotate(45deg)';
                    }
                });
            });
            // --- Gemini API Integration for Personalized Energy Saving Tips ---
            // Moved here from previous version to keep it separate but still functional
            const energyInput = document.getElementById('energy-input');
            const getTipsButton = document.getElementById('get-tips-button');
            const tipsOutput = document.getElementById('tips-output');
            const tipsContent = document.getElementById('tips-content');
            const geminiSpinner = document.getElementById('gemini-spinner'); // Specific spinner for Gemini API

            getTipsButton.addEventListener('click', async () => {
                const userPrompt = energyInput.value.trim();
                if (!userPrompt) {
                    tipsOutput.classList.remove('hidden');
                    tipsContent.innerHTML = '<p class="text-red-500">Please tell us something about your energy consumption.</p>';
                    return;
                }

                // Show loading spinner and hide previous output
                geminiSpinner.classList.remove('hidden'); // Show Gemini-specific spinner
                getTipsButton.disabled = true; // Disable button
                tipsOutput.classList.add('hidden');
                tipsContent.innerHTML = ''; // Clear previous content

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: `Give energy-saving tips for Indian households based on the following energy consumption details: ${userPrompt}. Please provide practical and actionable advice.` }] });

                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will automatically provide this at runtime. DO NOT change.
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                // Implement exponential backoff for API calls
                const MAX_RETRIES = 5;
                let retryCount = 0;
                let success = false;

                while (retryCount < MAX_RETRIES && !success) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            console.error('API Error:', errorData);
                            if (response.status === 429) { // Too Many Requests
                                const delay = Math.pow(2, retryCount) * 1000; // Exponential backoff
                                console.warn(`Rate limit hit, retrying in ${delay / 1000}s...`);
                                await new Promise(resolve => setTimeout(resolve, delay));
                                retryCount++;
                                continue; // Retry the request
                            } else {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                        }

                        const result = await response.json();

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            tipsContent.innerHTML = text.replace(/\n/g, '<br>'); // Display newlines as breaks
                            tipsOutput.classList.remove('hidden'); // Show the output div
                            success = true; // Mark as success to exit loop
                        } else {
                            tipsOutput.classList.remove('hidden');
                            tipsContent.innerHTML = '<p class="text-red-500">Failed to get tips. Please try again.</p>';
                            console.error('Unexpected API response structure:', result);
                            break; // Exit loop if structure is unexpected
                        }
                    } catch (error) {
                        console.error('Fetch error:', error);
                        tipsOutput.classList.remove('hidden');
                        tipsContent.innerHTML = '<p class="text-red-500">Network error or failed to retrieve tips. Please check your internet connection and try again.</p>';
                        break; // Exit loop on general errors
                    } finally {
                        geminiSpinner.classList.add('hidden'); // Hide Gemini-specific spinner
                        getTipsButton.disabled = false; // Enable button
                    }
                }

                if (!success && retryCount === MAX_RETRIES) {
                    tipsOutput.classList.remove('hidden');
                    tipsContent.innerHTML = '<p class="text-red-500">Failed to get tips after several attempts. Please try again later.</p>';
                }
            });
        });
    </script>

</body>
</html>